# 1. 프로젝트 생성
npx create-next-app@latest bank-app

# 2. 폴더 이동
cd bank-app

# 3. SQLite 관련 패키지 설치
npm install sqlite sqlite3

# 4. SQLite DB 생성
# ① 폴더 만들기
mkdir db

# 5. sql 생성

# 6. DB 초기화
sqlite3 db/database.db < db/schema.sql
Get-Content db/schema.sql | sqlite3 db/database.db

# 7. 실행
npm run dev

# ##################################################
# sql 동적 조건 사용 시
export async function GET(req: Request) {
  const db = await openDB();
  const url = new URL(req.url);
  const bankId = url.searchParams.get('bank_id'); // optional
  const typeId = url.searchParams.get('type_id'); // optional

  const conditions: string[] = [];
  const params: any[] = [];

  if(bankId) {
    conditions.push('b.bank_id = ?');
    params.push(Number(bankId));
  }
  if(typeId) {
    conditions.push('a.account_type_id = ?');
    params.push(Number(typeId));
  }

  const whereClause = conditions.length > 0 ? 'WHERE ' + conditions.join(' AND ') : '';

  const mappings = await db.all(`
    SELECT bat.id, b.bank_name, a.type_name
    FROM bank_account_type bat
    JOIN bank b ON bat.bank_id = b.bank_id
    JOIN account_type a ON bat.account_type_id = a.account_type_id
    ${whereClause}
    ORDER BY b.bank_name, a.type_name
  `, params);

  await db.close();
  return NextResponse.json({ mappings });
}
